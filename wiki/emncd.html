<!DOCTYPE html>
<html>
<head>
<title>NCD in Javascript</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>

<p>This is a quick port of my <a href="http://code.google.com/p/badvpn/wiki/NCD">NCD programming language</a>
to Javascript using the <a href="https://github.com/kripken/emscripten">Emscripten</a> compiler.</p>

<p>Please open the Javascript console so you can see the output (Chrome: CTRL+Shift+J. Firefox: CTRL+Shift+K).</p>

<script src="emncd.js"></script>

<script>

var cfunc_emncd_start = Module.cwrap('emncd_start', 'null', ['string']);
var cfunc_emncd_stop = Module.cwrap('emncd_stop', 'null', []);

function on_start ()
{
    var code = document.getElementById('codetext').value;
    
    var loglevel = 0;
    for (i = 0; i <= 5; i++) {
        if (document.getElementById('loglevel' + i).checked) {
            loglevel = i;
        }
    }

    cfunc_emncd_start(code, loglevel);
}

function on_stop ()
{
    cfunc_emncd_stop();
}

function load_example (num)
{
    document.getElementById('codetext').value = document.getElementById('example' + num).value;
}

</script>

<textarea id="example1" style="display:none;">
process foo {
    println("Starting up, please wait...");
    rprintln("Goodbye World!");

    sleep("500", "300"); # sleeps 500ms on init and 300ms on deinit

    println("Hello World!");
    rprintln("Shutting down, please wait...");
}
</textarea>

<textarea id="example2" style="display:none;">
process hello {
    var("0") ctr;

    blocker() blk;
    blk->up();
    blk->use();

    num_modulo(ctr, "3") m_three;
    num_modulo(ctr, "5") m_five;
    num_equal(m_three, "0") d_three;
    num_equal(m_five, "0") d_five;
    and(d_three, d_five) d_three_five;

    If (d_three_five) {
        println("fizzbuzz");
    } Elif (d_three) {
        println("fizz");
    } Elif (d_five) {
        println("buzz");
    } else {
        println(ctr);
    };

    num_add(ctr, "1") i;
    num_modulo(i, "20") i;
    ctr->set(i);

    sleep("100", "0");
    blk->downup();

}
</textarea>

<textarea id="example3" style="display:none;">
process hello {
    println("Hello, NCD in Javascript!");
    println("Will now wait 2 seconds.");
    rprintln("Goodbye.");

    sleep("2000", "3000");
    rprintln("Waiting 3 seconds before dying.");

    call("func", {"FirstArg", "SecondArg"});
    
    var({"one", "two", "three"}) list;
    to_string(list) str;
    println(str);
    
    Foreach (list As elem) {
        println("start ", elem);
        rprintln("stop ", elem);
    };

    println("We're finished. Press \"Request termination\" to unwind us.");
    rprintln("Terminating...");
}

template func {
    println("func here, my args are: ", _arg0, " ", _arg1);
    rprintln("func going away");
}
</textarea>

Examples:
<button onclick="load_example(1)">Example 1</button>
<button onclick="load_example(2)">Example 2</button>
<button onclick="load_example(3)">Example 3</button>
<br>

<textarea rows=30 cols=80 id="codetext">
process foo {
    println("Starting up, please wait...");
    rprintln("Goodbye World!");

    sleep("500", "300"); # sleeps 500ms on init and 300ms on deinit

    println("Hello World!");
    rprintln("Shutting down, please wait...");
}
</textarea><br>

Loglevel: 
<input type="radio" name="loglevel" id="loglevel0"> None
<input type="radio" name="loglevel" id="loglevel1"> Error
<input type="radio" name="loglevel" id="loglevel2" checked> Warning
<input type="radio" name="loglevel" id="loglevel3"> Notice
<input type="radio" name="loglevel" id="loglevel4"> Info
<input type="radio" name="loglevel" id="loglevel5"> Debug <br>

<button onclick="on_start()">Start NCD</button>
<button onclick="on_stop()">Request termination</button>

</body>
</html>
